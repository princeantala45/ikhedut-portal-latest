{% extends "base.html" %}

{% block title %}
Sell Crops
{% endblock title %}

{% block content %}

<div class="min-h-screen bg-gray-50 flex items-center justify-center px-4 py-8">
    <div class="w-full max-w-xl bg-white rounded-xl shadow-lg p-6 sm:p-8">
        <h2 id="otherpageheader" class="text-2xl font-semibold text-center text-gray-800 mb-6">
            Sell Your Crops
        </h2>   

        <form method="post" id="sellForm" enctype="multipart/form-data">

            {% csrf_token %} 

            <div>
                <label for="crop" class="block text-sm font-medium text-gray-700 mb-2 mt-2">
                    Select Crop / Produce
                </label> 

                <select name="crop" id="crop" required
                    class="w-full rounded-lg border border-gray-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500">
                    <option value="">-- Select Item --</option>

                    <!-- Crops -->
                    <optgroup label="ğŸŒ¾ Crops">
                        <option value="wheat">ğŸŒ¾ Wheat</option>
                        <option value="rice">ğŸš Rice</option>
                        <option value="corn">ğŸŒ½ Corn</option>
                        <option value="cotton">ğŸ§µ Cotton</option>
                        <option value="groundnut">ğŸ¥œ Groundnut</option>
                        <option value="sugarcane">ğŸ¬ Sugarcane</option>
                    </optgroup>

                    <!-- Vegetables -->
                    <optgroup label="ğŸ¥• Vegetables">
                        <option value="tomato">ğŸ… Tomato</option>
                        <option value="potato">ğŸ¥” Potato</option>
                        <option value="onion">ğŸ§… Onion</option>
                        <option value="garlic">ğŸ§„ Garlic</option>
                        <option value="carrot">ğŸ¥• Carrot</option>
                        <option value="cabbage">ğŸ¥¬ Cabbage</option>
                        <option value="cauliflower">ğŸ¥¦ Cauliflower</option>
                        <option value="chilli">ğŸŒ¶ï¸ Chilli</option>
                        <option value="brinjal">ğŸ† Brinjal</option>
                    </optgroup>

                    <!-- Fruits -->
                    <optgroup label="ğŸ Fruits">
                        <option value="apple">ğŸ Apple</option>
                        <option value="banana">ğŸŒ Banana</option>
                        <option value="mango">ğŸ¥­ Mango</option>
                        <option value="orange">ğŸŠ Orange</option>
                        <option value="grapes">ğŸ‡ Grapes</option>
                        <option value="papaya">ğŸˆ Papaya</option>
                        <option value="watermelon">ğŸ‰ Watermelon</option>
                    </optgroup>
                </select>

            </div>

            <!-- Quantity -->
            <div>
                <label for="quantity" class="block text-sm font-medium text-gray-700 mb-2 mt-2">
                    Quantity (Kg)
                </label>
                <input type="number" name="quantity" id="quantity" min="20" max="100000" required
                    class="w-full rounded-lg border border-gray-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500">
                <p class="text-xs text-gray-500 mt-1">
                    Minimum 20 Kg and maximum 100,000 Kg allowed
                </p>
            </div>

            <!-- Price -->
            <div style="cursor: not-allowed;">
                <label style="cursor: not-allowed;" for="price" class="block text-sm font-medium text-gray-700 mb-2 mt-2">
                    Expected Price (â‚¹ per 20 KG)
                </label>
                <input style="cursor: not-allowed;" type="number" name="price" id="price" readonly
                    class="w-full rounded-lg border border-gray-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-green-500">
            </div>

            <!-- Crop Image -->
            <div>
                <label for="image" class="block text-sm font-medium text-gray-700 mb-2 mt-2">
                    Crop Image
                </label>
                <input type="file" name="image" id="image" accept="image/*" required class="w-full text-sm text-gray-600 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-medium file:bg-green-50 file:text-green-700 hover:file:bg-green-100">
            </div>

            <!-- Submit Button -->

            <div class="pt-3 flex justify-center lg:justify-start">
                <button type="submit" class="cssbuttons-io-button">
                    Submit Crop Details
                    <div class="icon">
                        <svg height="24" width="24" viewBox="0 0 24 24">
                            <path d="M0 0h24v24H0z" fill="none"></path>
                            <path d="M16.172 11l-5.364-5.364 1.414-1.414L20 12l-7.778 7.778-1.414-1.414L16.172 13H4v-2z"
                                fill="currentColor"></path>
                        </svg>
                    </div>
                </button>
            </div>
        </form>
    </div>
</div>

<!-- Auto Price Script -->
<script>
    const cropPrices = {
        wheat: 500,
        rice: 480,
        corn: 460,
        cotton: 1200,
        groundnut: 900,
        sugarcane: 800,

        tomato: 500,
        potato: 360,
        onion: 300,
        garlic: 3200,
        carrot: 600,
        cabbage: 300,
        cauliflower: 440,
        chilli: 1200,
        brinjal: 500,

        apple: 3000,
        banana: 500,
        mango: 2200,
        orange: 1200,
        grapes: 1600,
        papaya: 500,
        watermelon: 360
    };

    const cropSelect = document.getElementById("crop");
    const priceInput = document.getElementById("price");

cropSelect.addEventListener("change", () => {
    if (cropSelect.value) {
        priceInput.disabled = false;
        priceInput.value = cropPrices[cropSelect.value];
    } else {
        priceInput.value = "";
        priceInput.disabled = true;
    }
});

</script>

<script>
    document.getElementById("sellForm").addEventListener("submit", async function (e) {
        e.preventDefault();

        const formData = new FormData(this);

        const response = await fetch("/api/sellcrops/", {
            method: "POST",
            headers: {
                "X-CSRFToken": "{{ csrf_token }}"
            },
            body: formData
        });

        const data = await response.json();

if (response.ok) {
    alert("Crop submitted successfully waiting for admin approval");
    window.location.reload();
        } else {
            alert("Something went wrong");
            console.log(data);
        }
    });
</script>

{% endblock content %}